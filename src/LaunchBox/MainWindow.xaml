<Window x:Class="LaunchBox.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        mc:Ignorable="d"
        Title="LaunchBox - Game Library Manager"
        Height="800" Width="1400"
        WindowState="Maximized"
        Background="#1E1E1E">

    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <!-- Top Menu Bar -->
        <Menu Grid.Row="0" Background="#2D2D30" Foreground="White">
            <MenuItem Header="File">
                <MenuItem Header="Add Game" Command="{Binding AddGameCommand}"/>
                <MenuItem Header="Scan ROM Folder" Command="{Binding ScanRomFolderCommand}"/>
                <Separator/>
                <MenuItem Header="Import Configuration"/>
                <MenuItem Header="Export Configuration"/>
                <Separator/>
                <MenuItem Header="Exit" Click="Exit_Click"/>
            </MenuItem>
            <MenuItem Header="Library">
                <MenuItem Header="Refresh" Command="{Binding LoadGamesCommand}"/>
                <MenuItem Header="Show Favorites Only" IsCheckable="True" IsChecked="{Binding ShowFavoritesOnly}"/>
            </MenuItem>
            <MenuItem Header="View">
                <MenuItem Header="Grid View" Command="{Binding SwitchViewModeCommand}" CommandParameter="Grid"/>
                <MenuItem Header="List View" Command="{Binding SwitchViewModeCommand}" CommandParameter="List"/>
                <MenuItem Header="Details View" Command="{Binding SwitchViewModeCommand}" CommandParameter="Details"/>
            </MenuItem>
            <MenuItem Header="Tools">
                <MenuItem Header="Emulator Manager" Command="{Binding OpenEmulatorManagerCommand}"/>
                <MenuItem Header="Plugin Manager" Command="{Binding OpenPluginManagerCommand}"/>
                <Separator/>
                <MenuItem Header="Settings" Command="{Binding OpenSettingsCommand}"/>
            </MenuItem>
            <MenuItem Header="Help">
                <MenuItem Header="About"/>
            </MenuItem>
        </Menu>

        <!-- Toolbar -->
        <ToolBar Grid.Row="1" Background="#3E3E42" Padding="10,5">
            <Button Content="Add Game" Command="{Binding AddGameCommand}" Padding="10,5" Margin="0,0,5,0"/>
            <Button Content="Scan Folder" Command="{Binding ScanRomFolderCommand}" Padding="10,5" Margin="0,0,5,0"/>
            <Separator/>
            <TextBlock Text="Search:" VerticalAlignment="Center" Foreground="White" Margin="10,0,5,0"/>
            <TextBox Width="300" Text="{Binding SearchText, UpdateSourceTrigger=PropertyChanged}"
                     VerticalAlignment="Center" Padding="5"/>
            <Separator/>
            <ToggleButton Content="Favorites" IsChecked="{Binding ShowFavoritesOnly}" Padding="10,5" Margin="5,0"/>
            <Separator/>
            <ComboBox Width="200" SelectedItem="{Binding SelectedPlatform}" DisplayMemberPath="Name"
                      VerticalAlignment="Center" Padding="5">
                <ComboBox.Items>
                    <ComboBoxItem Content="All Platforms"/>
                </ComboBox.Items>
            </ComboBox>
        </ToolBar>

        <!-- Main Content Area -->
        <Grid Grid.Row="2">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="Auto"/>
                <ColumnDefinition Width="350"/>
            </Grid.ColumnDefinitions>

            <!-- Games Grid/List View -->
            <Border Grid.Column="0" Background="#252526" Margin="5">
                <Grid>
                    <!-- Grid View -->
                    <ScrollViewer VerticalScrollBarVisibility="Auto"
                                  Visibility="{Binding CurrentViewMode, Converter={StaticResource ViewModeToVisibilityConverter}, ConverterParameter=Grid, FallbackValue=Visible}">
                        <ItemsControl ItemsSource="{Binding Games}">
                            <ItemsControl.ItemsPanel>
                                <ItemsPanelTemplate>
                                    <WrapPanel Orientation="Horizontal"/>
                                </ItemsPanelTemplate>
                            </ItemsControl.ItemsPanel>
                            <ItemsControl.ItemTemplate>
                                <DataTemplate>
                                    <Border Width="200" Height="280" Margin="10" Background="#2D2D30"
                                            BorderBrush="#3E3E42" BorderThickness="1" Cursor="Hand">
                                        <Border.InputBindings>
                                            <MouseBinding MouseAction="LeftDoubleClick"
                                                         Command="{Binding DataContext.LaunchGameCommand, RelativeSource={RelativeSource AncestorType=Window}}"
                                                         CommandParameter="{Binding}"/>
                                        </Border.InputBindings>
                                        <Grid>
                                            <Grid.RowDefinitions>
                                                <RowDefinition Height="*"/>
                                                <RowDefinition Height="Auto"/>
                                            </Grid.RowDefinitions>

                                            <!-- Box Art -->
                                            <Border Grid.Row="0" Background="#1E1E1E" Margin="5,5,5,0">
                                                <Image Source="{Binding BoxArtPath}" Stretch="Uniform">
                                                    <Image.Style>
                                                        <Style TargetType="Image">
                                                            <Style.Triggers>
                                                                <DataTrigger Binding="{Binding BoxArtPath}" Value="{x:Null}">
                                                                    <Setter Property="Visibility" Value="Collapsed"/>
                                                                </DataTrigger>
                                                            </Style.Triggers>
                                                        </Style>
                                                    </Image.Style>
                                                </Image>
                                            </Border>

                                            <!-- Game Title and Info -->
                                            <StackPanel Grid.Row="1" Margin="5">
                                                <TextBlock Text="{Binding Title}" FontWeight="Bold" Foreground="White"
                                                          TextTrimming="CharacterEllipsis" FontSize="14"/>
                                                <TextBlock Text="{Binding Platform.Name}" Foreground="#AAAAAA"
                                                          FontSize="11" Margin="0,2,0,0"/>
                                                <StackPanel Orientation="Horizontal" Margin="0,5,0,0">
                                                    <TextBlock Text="â˜…" Foreground="Gold" FontSize="12"
                                                              Visibility="{Binding IsFavorite, Converter={StaticResource BoolToVisibilityConverter}}"/>
                                                    <TextBlock Text="{Binding PlayCount, StringFormat='Played: {0} times'}"
                                                              Foreground="#888888" FontSize="10" Margin="5,0,0,0"/>
                                                </StackPanel>
                                            </StackPanel>
                                        </Grid>
                                    </Border>
                                </DataTemplate>
                            </ItemsControl.ItemTemplate>
                        </ItemsControl>
                    </ScrollViewer>

                    <!-- Loading Indicator -->
                    <Grid Visibility="{Binding IsLoading, Converter={StaticResource BoolToVisibilityConverter}}">
                        <Grid.Background>
                            <SolidColorBrush Color="Black" Opacity="0.5"/>
                        </Grid.Background>
                        <TextBlock Text="Loading..." FontSize="24" Foreground="White"
                                  HorizontalAlignment="Center" VerticalAlignment="Center"/>
                    </Grid>

                    <!-- Empty State -->
                    <StackPanel HorizontalAlignment="Center" VerticalAlignment="Center"
                               Visibility="{Binding Games.Count, Converter={StaticResource ZeroToVisibilityConverter}}">
                        <TextBlock Text="No games found" FontSize="24" Foreground="#888888" TextAlignment="Center"/>
                        <TextBlock Text="Add games or scan a ROM folder to get started"
                                  FontSize="14" Foreground="#666666" TextAlignment="Center" Margin="0,10,0,0"/>
                        <Button Content="Scan ROM Folder" Command="{Binding ScanRomFolderCommand}"
                               Padding="15,8" Margin="0,20,0,0" HorizontalAlignment="Center"/>
                    </StackPanel>
                </Grid>
            </Border>

            <!-- Splitter -->
            <GridSplitter Grid.Column="1" Width="5" Background="#3E3E42"
                         HorizontalAlignment="Center" VerticalAlignment="Stretch"/>

            <!-- Game Details Panel -->
            <Border Grid.Column="2" Background="#1E1E1E" Margin="0,5,5,5">
                <ScrollViewer VerticalScrollBarVisibility="Auto">
                    <StackPanel Margin="15" DataContext="{Binding SelectedGame}">
                        <TextBlock Text="Game Details" FontSize="20" FontWeight="Bold" Foreground="White" Margin="0,0,0,20"/>

                        <Border Background="#252526" Padding="10" Margin="0,0,0,15"
                               Visibility="{Binding Converter={StaticResource NullToVisibilityConverter}, ConverterParameter=Inverse}">
                            <StackPanel>
                                <!-- Box Art -->
                                <Border Background="#1E1E1E" Height="300" Margin="0,0,0,15">
                                    <Image Source="{Binding BoxArtPath}" Stretch="Uniform"/>
                                </Border>

                                <!-- Title -->
                                <TextBlock Text="{Binding Title}" FontSize="18" FontWeight="Bold"
                                          Foreground="White" TextWrapping="Wrap" Margin="0,0,0,10"/>

                                <!-- Platform -->
                                <StackPanel Orientation="Horizontal" Margin="0,0,0,5">
                                    <TextBlock Text="Platform:" Foreground="#AAAAAA" Width="100"/>
                                    <TextBlock Text="{Binding Platform.Name}" Foreground="White"/>
                                </StackPanel>

                                <!-- Developer -->
                                <StackPanel Orientation="Horizontal" Margin="0,0,0,5"
                                           Visibility="{Binding Developer, Converter={StaticResource NullToVisibilityConverter}, ConverterParameter=Inverse}">
                                    <TextBlock Text="Developer:" Foreground="#AAAAAA" Width="100"/>
                                    <TextBlock Text="{Binding Developer}" Foreground="White"/>
                                </StackPanel>

                                <!-- Publisher -->
                                <StackPanel Orientation="Horizontal" Margin="0,0,0,5"
                                           Visibility="{Binding Publisher, Converter={StaticResource NullToVisibilityConverter}, ConverterParameter=Inverse}">
                                    <TextBlock Text="Publisher:" Foreground="#AAAAAA" Width="100"/>
                                    <TextBlock Text="{Binding Publisher}" Foreground="White"/>
                                </StackPanel>

                                <!-- Release Year -->
                                <StackPanel Orientation="Horizontal" Margin="0,0,0,5"
                                           Visibility="{Binding ReleaseYear, Converter={StaticResource NullToVisibilityConverter}, ConverterParameter=Inverse}">
                                    <TextBlock Text="Release Year:" Foreground="#AAAAAA" Width="100"/>
                                    <TextBlock Text="{Binding ReleaseYear}" Foreground="White"/>
                                </StackPanel>

                                <!-- Genre -->
                                <StackPanel Orientation="Horizontal" Margin="0,0,0,5"
                                           Visibility="{Binding Genre, Converter={StaticResource NullToVisibilityConverter}, ConverterParameter=Inverse}">
                                    <TextBlock Text="Genre:" Foreground="#AAAAAA" Width="100"/>
                                    <TextBlock Text="{Binding Genre}" Foreground="White"/>
                                </StackPanel>

                                <!-- Play Count -->
                                <StackPanel Orientation="Horizontal" Margin="0,0,0,5">
                                    <TextBlock Text="Play Count:" Foreground="#AAAAAA" Width="100"/>
                                    <TextBlock Text="{Binding PlayCount}" Foreground="White"/>
                                </StackPanel>

                                <!-- Last Played -->
                                <StackPanel Orientation="Horizontal" Margin="0,0,0,15"
                                           Visibility="{Binding LastPlayedAt, Converter={StaticResource NullToVisibilityConverter}, ConverterParameter=Inverse}">
                                    <TextBlock Text="Last Played:" Foreground="#AAAAAA" Width="100"/>
                                    <TextBlock Text="{Binding LastPlayedAt, StringFormat='{}{0:g}'}" Foreground="White"/>
                                </StackPanel>

                                <!-- Description -->
                                <TextBlock Text="Description" FontWeight="Bold" Foreground="White" Margin="0,0,0,5"
                                          Visibility="{Binding Description, Converter={StaticResource NullToVisibilityConverter}, ConverterParameter=Inverse}"/>
                                <TextBlock Text="{Binding Description}" Foreground="#CCCCCC" TextWrapping="Wrap" Margin="0,0,0,15"
                                          Visibility="{Binding Description, Converter={StaticResource NullToVisibilityConverter}, ConverterParameter=Inverse}"/>

                                <!-- Action Buttons -->
                                <Button Content="Play Game"
                                       Command="{Binding DataContext.LaunchGameCommand, RelativeSource={RelativeSource AncestorType=Window}}"
                                       CommandParameter="{Binding}"
                                       Padding="0,10" Margin="0,0,0,10" FontSize="16" FontWeight="Bold"/>
                                <Button Content="{Binding IsFavorite, Converter={StaticResource FavoriteButtonTextConverter}}"
                                       Command="{Binding DataContext.ToggleFavoriteCommand, RelativeSource={RelativeSource AncestorType=Window}}"
                                       CommandParameter="{Binding}"
                                       Padding="0,8" Margin="0,0,0,10"/>
                                <Button Content="Edit Game" Padding="0,8"/>
                            </StackPanel>
                        </Border>

                        <!-- No Selection Message -->
                        <TextBlock Text="Select a game to view details"
                                  Foreground="#888888" FontStyle="Italic" TextAlignment="Center"
                                  Visibility="{Binding Converter={StaticResource NullToVisibilityConverter}}"/>
                    </StackPanel>
                </ScrollViewer>
            </Border>
        </Grid>

        <!-- Status Bar -->
        <StatusBar Grid.Row="3" Background="#007ACC" Foreground="White">
            <StatusBarItem>
                <TextBlock>
                    <Run Text="Total Games:"/>
                    <Run Text="{Binding Games.Count, Mode=OneWay}" FontWeight="Bold"/>
                </TextBlock>
            </StatusBarItem>
            <Separator/>
            <StatusBarItem>
                <TextBlock Text="{Binding SelectedPlatform.Name, StringFormat='Platform: {0}', FallbackValue='All Platforms'}"/>
            </StatusBarItem>
            <StatusBarItem HorizontalAlignment="Right">
                <TextBlock Text="LaunchBox MVP v1.0"/>
            </StatusBarItem>
        </StatusBar>
    </Grid>
</Window>
